aws ec2 describe-security-groups --query 'SecurityGroups[*].{GroupId:GroupId, GroupName:GroupName, IngressRules:IpPermissions[*], EgressRules:IpPermissionsEgress[*]}' --output json | jq -r '.[] | .GroupId as $groupId | .GroupName as $groupName | (.IngressRules[]? | "\($groupId),\($groupName),Inbound,\(.IpProtocol),\(.FromPort // "N/A"),\(.ToPort // "N/A"),\(.IpRanges[]?.CidrIp // "N/A")") , (.EgressRules[]? | "\($groupId),\($groupName),Outbound,\(.IpProtocol),\(.FromPort // "N/A"),\(.ToPort // "N/A"),\(.IpRanges[]?.CidrIp // "N/A")")' > security-group-rules.csv
